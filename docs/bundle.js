!function r(n,s,o){function i(t,e){if(!s[t]){if(!n[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}a=s[t]={exports:{}},n[t][0].call(a.exports,function(e){return i(n[t][1][e]||e)},a,a.exports,r,n,s,o)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)i(o[e]);return i}({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});const h=e("./Util");class d{constructor(t,e,a,r){if(this.r=0,this.g=0,this.b=0,this.a=0,this.hex=e=>("0"+Math.round(e).toString(16)).slice(-2),this.getHsl=()=>{var{r:e,g:t,b:a}=this,e=e/255,t=t/255,a=a/255,r=Math.max(e,t,a),n=Math.min(e,t,a),s=r-n;let o,i,l;return o=0==s?0:e===r?(t-a)/s%6:t===r?(a-e)/s+2:(e-t)/s+4,(o=Math.round(60*o))<0&&(o+=360),i=(r+n)/2,l=0==s?0:s/(1-Math.abs(2*i-1)),i=(0,h.round)(100*i,1),[o,(0,h.round)(100*l,1),i]},1===arguments.length){if(t instanceof d)return new d(...t.rgba);if("string"==typeof t&&"#"===t[0]){let e=t;return void(7!==(e=4===e.length?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:e).length&&9!==e.length||(this.r=parseInt(e[1]+e[2],16),this.g=parseInt(e[3]+e[4],16),this.b=parseInt(e[5]+e[6],16),9===e.length?this.a=parseInt(e[7]+e[8],16):this.a=255))}}3!==arguments.length&&4!==arguments.length||(r=null==r?255:r,"number"==typeof t&&"number"==typeof e&&"number"==typeof a&&(this.r=t,this.g=e,this.b=a),this.a=r)}get rgb(){var{r:e,g:t,b:a}=this;return[e,t,a]}get rgba(){var{r:e,g:t,b:a,a:r}=this;return[e,t,a,r]}toRgb(){var{r:e,g:t,b:a}=this;return`rgb(${[e,t,a].map(e=>Math.round(e)).join(", ")})`}toRgba(){var{r:e,g:t,b:a,a:r}=this,e=[e,t,a].map(e=>Math.round(e));return e.push((0,h.round)(r/255,2)),`rgba(${e.join(", ")})`}toHex6(){var{r:e,g:t,b:a,hex:r}=this;return"#"+r(e)+r(t)+r(a)}toHex8(){var{r:e,g:t,b:a,a:r,hex:n}=this;return"#"+n(e)+n(t)+n(a)+n(r)}toHsl(){var[e,t,a]=this.getHsl();return`hsl(${e}, ${t}%, ${a}%)`}toHsla(){var e=this["a"],[t,a,r]=this.getHsl();return`hsla(${t}, ${a}%, ${r}%, ${(0,h.round)(e/255,2)})`}}d.squaredValues=[...Array(256).keys()].map(e=>e*e),d.getMeanMedian=(t,a)=>{const r=a.averagingMethod,n=t.length,s=new d,o=new d,i=["r","g","b","a"];for(let e=0;e<i.length;e++){var l=i[e],h=[];for(let e=0;e<t.length;e++)h.push(t[e][l]);var u=h.sort();if("squared"===r){let t=0;for(let e=0;e<h.length;e++)t+=d.squaredValues[h[e]];const a=t/n,r=Math.sqrt(a);s[l]=r}if("simple"===r){let t=0;for(let e=0;e<h.length;e++)t+=h[e];const a=t/n;s[l]=a}var c=Math.floor(u.length/2);o[l]=u[c]}return[s,o]},d.getLightestDarkest=e=>{const t=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4),a=e.map(e=>{e=.2126*t(e.r/255)+.7152*t(e.g/255)+.0722*t(e.b/255);return e<=216/24389?24389/27*e:116*Math.pow(e,1/3)-16}),r=Math.max(...a),n=Math.min(...a),s=a.indexOf(r),o=a.indexOf(n);return[e[s],e[o]]},d.blendColors=(t,a)=>{const r=a.a/255,n=1-r,e=["r","g","b"].map(e=>t[e]*n+a[e]*r);return new d(...e)},a.default=d},{"./Util":6}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=class extends class{constructor(){return new Proxy(this,{get:(e,t)=>{var a=e.fieldHashmap[t.toString()];return a?a.value:e[t]}})}}{constructor(e,t){super(),this.onBeforeChange=(e,t)=>{var a,{fieldHashmap:r,fieldToBeforeChangeCallback:n,callback:s}=this,r=r[e];r&&(a=n[e],s&&r.removeEventListener("change",s),a&&r.removeEventListener("change",a),r.addEventListener("change",t),s&&r.addEventListener("change",s),n[e]=t)},this.triggerAllBeforeChangeCallbacks=()=>{const{fieldArray:e,fieldToBeforeChangeCallback:t}=this;e.forEach(e=>{e=t[e.name];e&&e()})},this.fieldArray=e,this.fieldHashmap={},this.fieldToBeforeChangeCallback={},e.forEach(e=>{this.fieldHashmap[e.name]=e}),t&&(this.onChange=t)}set onChange(t){const{fieldArray:e,callback:a}=this;e.forEach(e=>{a&&e.removeEventListener("change",a),e.addEventListener("change",t)}),this.callback=t}}},{}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});const u=e("./Color"),c=e("./Util");a.default=class{constructor(e,t){this.handleReadUpload=()=>{const{uploader:e,image:t}=this,a=new FileReader;if(a.addEventListener("load",e=>{if(!e.target||!e.target.result)throw"Failed to read uploaded file.";t.src=e.target.result.toString()}),!e.files)throw"Asked to read image file but found no file was uploaded.";a.readAsDataURL(e.files[0])},this.handleUpdateImage=()=>{const{preview:e,context:t,image:a,opacity:r,backgroundColor:n}=this,{width:s,height:o}=a,i=t=>{var a=[];for(let e=0;e<t.length;e+=4){var r=t[e+0],n=t[e+1],s=t[e+2],o=t[e+3];a.push(new u.default(r,n,s,o))}return a};if(0===s||0===o)return!1;e.width=s,e.height=o,t.clearRect(0,0,s,o),t.drawImage(a,0,0);var l=t.getImageData(0,0,s,o),h=l.data;if(!r&&!n)return this.colors=i(h),!0;if(r){for(let e=0;e<h.length;e+=4){const t=h[e+3]*(r||1),a=(0,c.clamp)(t,0,255);h[e+3]=a}if(t.putImageData(l,0,0),!n)return this.colors=i(h),!0}if(n){const a=new OffscreenCanvas(s,o),r=a.getContext("2d");if(!r)throw"Failed to get 2D context of offscreen canvas.";r.fillStyle=n.toRgba(),r.fillRect(0,0,s,o),r.drawImage(e,0,0),t.drawImage(a,0,0),this.colors=i(t.getImageData(0,0,s,o).data)}},this.loadExampleImage=()=>{this.image.src="./example.png"},this.getColorsAt=(a,e,r,n)=>{var{preview:s,colors:o}=this,i=[];for(let t=e;t<e+n;t++)for(let e=a;e<a+r;e++){const a=t*s.width+e;a<0||a>o.length||i.push(o[a])}return i},this.setBackgroundColor=e=>{0===e.a?delete this.backgroundColor:this.backgroundColor=e,this.handleUpdateImage()},this.setOpacity=e=>{1===e?delete this.opacity:this.opacity=e,this.handleUpdateImage()};var a=new Image,t=(a.addEventListener("load",this.handleUpdateImage),t.addEventListener("change",this.handleReadUpload),this.preview=e,this.uploader=t,e.getContext("2d"));if(!t)throw"Failed to get 2D context from canvas element.";this.context=t,this.image=a,this.colors=[]}}},{"./Color":1,"./Util":6}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=class{constructor(e){this.setBackgroundColor=e=>{const t=this["resultElementArray"],a=e.toRgba();t.forEach(e=>{e.backgroundElement.style.backgroundColor=a})},this.setResult=(e,t,a)=>{var r=this["resultElementHashmap"],n=a.resultFormat,a=a.hideAlphaChannel;let s=!1,o=("always"===a?s=!1:"never"!==a&&255===t.a||(s=!0),"");if("rgb"===n&&(o=s?t.toRgba():t.toRgb()),"hex"===n&&(o=s?t.toHex8():t.toHex6()),!(o="hsl"===n?s?t.toHsla():t.toHsl():o))throw"Invalid resultFormat option: "+n.toString();r[e].textElement.value=o},this.resultElementArray=[],this.resultElementHashmap={},e.forEach(e=>{const t=e.querySelector("input[type=text]"),r=e.querySelector(".foreground"),a=e.querySelector(".background"),n=e.querySelector(".copy");n&&n.addEventListener("click",e=>{e.preventDefault(),navigator.clipboard.writeText(t.value)});var e=new Proxy(t,{set:(e,t,a)=>("value"===t&&(r.style.backgroundColor=a),e[t]=a,!0)}),s=t.name.split("ResultText")[0],e={textElement:e,foregroundElement:r,backgroundElement:a};this.resultElementHashmap[s]=e,this.resultElementArray.push(e)})}}},{}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});const r=e("./Util");a.default=class{constructor(e,t,a){this.isInProgress=!1,this.startPosition={x:0,y:0},this.endPosition={x:0,y:0},this.handleTouch=e=>{var t,a,r,n,{targetTouches:s,changedTouches:o,type:i}=e;2===s.length&&(e.preventDefault(),{target:e,updateInfo:t,updateOutline:a,callback:r}=this,i="touchend"===i?o:s,o=e.getBoundingClientRect(),s=Math.round(i[0].clientX-o.left),e=Math.round(i[0].clientY-o.top),n=Math.round(i[1].clientX-o.left),i=Math.round(i[1].clientY-o.top),this.startPosition={x:s,y:e},this.endPosition={x:n,y:i},t(),a(),r)&&r()},this.handleSelect=e=>{var{type:e,button:t,clientX:a,clientY:r}=e,{target:n,isInProgress:s,updateInfo:o,updateOutline:i,callback:l}=this;null!==t&&0!==t||(t=n.getBoundingClientRect(),n=Math.round(a-t.left),a=Math.round(r-t.top),"mousedown"===e?(this.startPosition={x:n,y:a},this.isInProgress=!0):s&&("mousemove"!==e&&"mouseup"!==e&&"mouseleave"!==e||(this.endPosition={x:n,y:a},o(),i(),l&&l()),"mouseup"!==e&&"mouseleave"!==e||(this.isInProgress=!1)))},this.updateInfo=()=>{var{startPosition:e,endPosition:t,target:a}=this,r=Math.max(Math.min(e.y,t.y),0),n=Math.max(Math.min(e.x,t.x),0),s=Math.min(Math.max(e.y,t.y),a.height),e=Math.min(Math.max(e.x,t.x),a.width),t=Math.max(e-n,1),a=Math.max(s-r,1);this.info={top:r,left:n,bottom:s,right:e,width:t,height:a}},this.updateOutline=()=>{var e,t,a,{outline:r,info:n}=this;n&&({top:n,left:e,width:t,height:a}=n,r.style.cssText=`top:${n}px; left:${e}px; width:${t}px; height:${a}px;`)},this.clear=()=>{var e=this["outline"];e.style.cssText="",delete this.info},t.onmousedown=this.handleSelect,t.onmouseup=this.handleSelect,t.onmousemove=this.handleSelect,t.onmouseleave=this.handleSelect,t.ontouchstart=this.handleTouch,t.ontouchend=this.handleTouch,t.ontouchmove=this.handleTouch,this.outline=e,this.target=t,a&&(this.onSelectionEnd=a)}set onSelectionEnd(e){this.callback=(0,r.debounce)(e)}}},{"./Util":6}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.clamp=a.round=a.debounce=void 0;a.debounce=(t,a=150)=>{let r;return(...e)=>{clearTimeout(r),r=setTimeout(()=>t.apply(this,e),a)}},a.round=(e,t=0)=>+(Math.round(+(e+"e+"+t))+"e-"+t);a.clamp=(e,t,a)=>Math.max(Math.min(e,a),t)},{}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});const p=e("./classes/Color"),m=e("./classes/Options"),v=e("./classes/Preview"),b=e("./classes/Selection"),y=e("./classes/Results");requestAnimationFrame(function(){const e=e=>Array.from(document.querySelectorAll(e)),t=e(".options")[0],a=e(".results")[0],r=(t.reset(),a.reset(),t.addEventListener("submit",e=>{e.preventDefault(),d()}),e(".options :is(input, select)")),n=e(".results .field"),s=e(".preview")[0],o=e("input[name=imageUpload]")[0],i=e(".selector")[0],l=new m.default(r),h=new v.default(s,o),u=new y.default(n),c=new b.default(i,s),d=()=>{var e,t,a,r;c.info&&({top:e,left:r,width:t,height:a}=c.info,r=h.getColorsAt(r,e,t,a),[e,t]=p.default.getMeanMedian(r,l),[a,r]=p.default.getLightestDarkest(r),u.setResult("mean",e,l),u.setResult("median",t,l),u.setResult("lightest",a,l),u.setResult("darkest",r,l))};o.addEventListener("change",c.clear);var g=e("#example-image-button")[0],f=e("button[type=reset]")[0],g=(g.addEventListener("click",()=>{c.clear(),h.loadExampleImage()}),f.addEventListener("click",()=>{t.reset(),l.triggerAllBeforeChangeCallbacks(),d()}),l.onBeforeChange("opacityPercentage",()=>{var e=l.opacityPercentage;h.setOpacity(e/100)}),()=>{var e=l.transparencyType;let t=null;if("straight"===e&&(t=new p.default(0,0,0,0)),!(t="premultiplied"===e?new p.default(l.backgroundColor):t))throw"Invalid transparency type option: "+e.toString();h.setBackgroundColor(t),u.setBackgroundColor(t),d()});l.onBeforeChange("backgroundColor",g),l.onBeforeChange("transparencyType",g),c.onSelectionEnd=d,l.onChange=d})},{"./classes/Color":1,"./classes/Options":2,"./classes/Preview":3,"./classes/Results":4,"./classes/Selection":5}]},{},[7]);
//# sourceMappingURL=bundle.js.map
